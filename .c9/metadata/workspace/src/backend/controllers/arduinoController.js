{"changed":true,"filter":false,"title":"arduinoController.js","tooltip":"/src/backend/controllers/arduinoController.js","value":"/**\n * Created by Maciej on 6/16/2014.\n */\n\n/**\n *\n * @param app\n * @param arduinoModel\n */\nvar arduino = require('../../routes/arduino')\nvar arduinoModell = require('../../backend/service/arduino');\nvar Astronaut = require('../../backend/service/astronauts');\n\n//Arduino Controller\nfunction ArduinoController() {\n\n    /*--------------------------private------------------------------------*/\n    var name = 'ArduinoController';\n    var that = this;    //that refers to ArduinoController object\n    that.debug = false;\n    arduino = {};\n    \n    /*---------------------------public ----------------------------------*/\n    return {\n        \n        _that: this,//_that refers to closure object\n    \n        getName: function(){\n            return name;\n        },\n\n        setDebug: function(flag){\n            that.debug = flag;\n        },\n        \n        \n\n        run: function (app, arduinoModel ,db, io) {\n\n            if(that.debug) {\n                console.log(\"inside arduino controllers run function! Die bitch\");\n                console.log(\"controller name: \",this.getName());\n            }\n            /*console loggin data on every request ex. page reload-------------------for what ?-----------------------*/\n            \n            app.use(function(req,res,next){\n                console.log('something happening here');\n                next();\n            });\n\n            /*************************setting routes ***********************************/\n            app.route('/arduino')\n                .get(function(req,res,next){\n                    res.render('arduino', {\n                        title: 'Express',\n                        serial_data: {\n                            data: \"sample data\"\n                        }\n                    });\n                });\n\n            app.route('/arduino')\n                .get(function (req, res, next) {\n\n                    //TODO\n                    //arduinoModel.connect();\n                    //app.get('/arduino', arduino.arduino) //ok but could be better\n                    //app.get('/about', about.list);\n                    //app.get('/about', about.about.d(userModel));\n                    var serialData_Mock = \"this is sample data for test purpose\";\n                    var temperatureData = arduinoModel.getTemperatureData();\n                    var serialData = arduinoModel.getSerialData();\n                    var internalSensorData = arduinoModel.getInternalTemperatureSensorData();\n\n                    //var serialData = serialData_Mock;\n                    //var temperatureData = serialData_Mock;\n                    //var internalSensorData = serialData_Mock;\n\n                    var abstract = {\n                        serial: serialData,\n                        temp: temperatureData,\n                        internal: internalSensorData\n                    }\n\n                    app.param('id', function (req, res, next, id) {\n                        console.log(\"CALLED ONLY ONCE\");\n                    });\n\n\n                    res.render('arduino', {\n                        title: 'Express',\n                        serial_data: {\n                            data: serialData\n\n                        },\n                        temperature: temperatureData,\n                        internal_sensor: abstract.internal\n                    });\n\n                    io.on('connection', function (socket) {\n\n                        socket.emit('serialData', {message: serialData});\n\n                        socket.on('myevent', function (data) {\n                            socket.emit('serialData', {message: serialData});\n                        });\n\n                        socket.on('randomData', function (data) {\n                            socket.on('myevent', function (data) {\n                                socket.emit('serialData', {message: serialData});\n                            });\n                        });\n\n                        socket.on('disconnect', function(socket){\n                            socket.emit('disconnect');\n                            console.log('client disconnected');\n                        });\n                    });\n                });\n\n            app.get('/arduino/:model/:id', function (req, res, next) {\n                if (!req.params.model && !req.params.id){\n                    console.log('caling next from model/id');\n                    next();// pass control to the next router handler\n                }\n                console.log('arduino model: ' + req.params.model + \" with id: \" + req.params.id);\n                res.render('arduino', {d: \"some_nice_data:DDDDD\"});\n                //next();\n            });\n\n            /*route for arduino model*/ //working ok\n            app.route('/arduino/:model')\n\n                .get(function (req, res, next) {\n                    var model = req.params.model;\n                    if (model != \"uno\") {\n                        next();\n                    }else {\n                        console.log(\"arduino modell: \", model);\n                        //res.render('arduino', {d: \"some_nice_data:DDDDD\"});\n                        res.json('arduino',{data: \"sample data from model uno\"});\n\n                        //next();\n                    }\n                });\n\n            /*route for arduino with id*/ // working ok\n            app.route('/arduino/:id')\n                .get(function (req, res, next) {\n                    var id = parseInt(req.params.id);\n                    if(that.debug) {\n                        console.log(\"debug: arduino id:\", id);\n                    }\n                    res.json('arduino', {data:\"sample data from arduino id:\" + req.params.id});\n                /*\n                res.render('/arduino', {\n                    title: 'Express',\n                    serial_data: abstract.serial,\n                    temperature: abstract.temp,\n                    internal_sensor: abstract.internal\n                });\n                */\n                //next();\n            });\n\n        }\n        //TODO next controller functions...\n    };\n};\n\nmodule.exports = ArduinoController;\n\n","undoManager":{"mark":-76,"position":100,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":26,"column":71},"end":{"row":26,"column":72}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":26,"column":72},"end":{"row":26,"column":73}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":26,"column":73},"end":{"row":26,"column":74}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":15,"column":0},"end":{"row":16,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":16,"column":0},"end":{"row":17,"column":0}},"text":"\n"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":0},"end":{"row":17,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":4},"end":{"row":17,"column":5}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":5},"end":{"row":17,"column":6}},"text":"/"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":5},"end":{"row":17,"column":6}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":6},"end":{"row":17,"column":7}},"text":"*"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":6},"end":{"row":17,"column":7}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":7},"end":{"row":17,"column":8}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":8},"end":{"row":17,"column":9}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":9},"end":{"row":17,"column":10}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":10},"end":{"row":17,"column":11}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":11},"end":{"row":17,"column":12}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":12},"end":{"row":17,"column":13}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":13},"end":{"row":17,"column":14}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":14},"end":{"row":17,"column":15}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":15},"end":{"row":17,"column":16}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":16},"end":{"row":17,"column":17}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":17},"end":{"row":17,"column":18}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":18},"end":{"row":17,"column":19}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":19},"end":{"row":17,"column":20}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":20},"end":{"row":17,"column":21}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":21},"end":{"row":17,"column":22}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":22},"end":{"row":17,"column":23}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":23},"end":{"row":17,"column":24}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":24},"end":{"row":17,"column":25}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":25},"end":{"row":17,"column":26}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":26},"end":{"row":17,"column":27}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":27},"end":{"row":17,"column":28}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":28},"end":{"row":17,"column":29}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":29},"end":{"row":17,"column":30}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":30},"end":{"row":17,"column":31}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":31},"end":{"row":17,"column":32}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":32},"end":{"row":17,"column":33}},"text":"p"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":33},"end":{"row":17,"column":34}},"text":"r"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":34},"end":{"row":17,"column":35}},"text":"i"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":35},"end":{"row":17,"column":36}},"text":"v"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":36},"end":{"row":17,"column":37}},"text":"a"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":37},"end":{"row":17,"column":38}},"text":"t"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":38},"end":{"row":17,"column":39}},"text":"e"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":39},"end":{"row":17,"column":40}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":39},"end":{"row":17,"column":40}},"text":" "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":39},"end":{"row":17,"column":40}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":40},"end":{"row":17,"column":41}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":41},"end":{"row":17,"column":42}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":42},"end":{"row":17,"column":43}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":43},"end":{"row":17,"column":44}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":44},"end":{"row":17,"column":45}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":45},"end":{"row":17,"column":46}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":46},"end":{"row":17,"column":47}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":47},"end":{"row":17,"column":48}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":48},"end":{"row":17,"column":49}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":49},"end":{"row":17,"column":50}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":50},"end":{"row":17,"column":51}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":51},"end":{"row":17,"column":52}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":52},"end":{"row":17,"column":53}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":53},"end":{"row":17,"column":54}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":54},"end":{"row":17,"column":55}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":55},"end":{"row":17,"column":56}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":56},"end":{"row":17,"column":57}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":57},"end":{"row":17,"column":58}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":58},"end":{"row":17,"column":59}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":59},"end":{"row":17,"column":60}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":60},"end":{"row":17,"column":61}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":61},"end":{"row":17,"column":62}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":62},"end":{"row":17,"column":63}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":63},"end":{"row":17,"column":64}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":64},"end":{"row":17,"column":65}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":65},"end":{"row":17,"column":66}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":66},"end":{"row":17,"column":67}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":67},"end":{"row":17,"column":68}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":68},"end":{"row":17,"column":69}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":69},"end":{"row":17,"column":70}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":70},"end":{"row":17,"column":71}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":71},"end":{"row":17,"column":72}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":72},"end":{"row":17,"column":73}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":73},"end":{"row":17,"column":74}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":74},"end":{"row":17,"column":75}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":75},"end":{"row":17,"column":76}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":76},"end":{"row":17,"column":77}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":77},"end":{"row":17,"column":78}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":17,"column":78},"end":{"row":17,"column":79}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":78},"end":{"row":17,"column":79}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":77},"end":{"row":17,"column":78}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":76},"end":{"row":17,"column":77}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":17,"column":75},"end":{"row":17,"column":76}},"text":"-"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeText","range":{"start":{"row":19,"column":4},"end":{"row":19,"column":45}},"text":"//that refers to ArduinoController object"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":19,"column":0},"end":{"row":20,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":20},"end":{"row":19,"column":24}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":19,"column":24},"end":{"row":19,"column":65}},"text":"//that refers to ArduinoController object"}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":21,"column":0},"end":{"row":22,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":22,"column":0},"end":{"row":23,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":22,"column":0},"end":{"row":23,"column":0}},"nl":"\n","lines":["    "]}]}],[{"group":"doc","deltas":[{"action":"removeLines","range":{"start":{"row":16,"column":0},"end":{"row":17,"column":0}},"nl":"\n","lines":[""]}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":26,"column":0},"end":{"row":26,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":24,"column":0},"end":{"row":24,"column":4}},"text":"    "}]}],[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":24,"column":4},"end":{"row":24,"column":8}},"text":"    "}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":26,"column":4},"end":{"row":26,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":42,"state":"no_regex","mode":"ace/mode/javascript"}},"timestamp":1416234698399}